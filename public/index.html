<!doctype html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RestartX WhatsApp Console</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Mono:wght@400;500&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
  <!-- Mobile Hamburger -->
  <button class="hamburger-btn" id="sidebarToggle" aria-label="Toggle menu">
    <i data-lucide="menu"></i>
  </button>
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  <section class="auth-shell" id="authShell">
    <div class="panel auth-card">
      <div class="brand-logo"
        style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px; justify-content: center;">
        <div class="brand-mark">RX</div>
        <h2 style="margin: 0;">RestartX Login</h2>
      </div>
      <p class="muted" style="text-align: center; margin-bottom: 8px; font-size: 14px;">Sign in to access your
        workspaces.</p>
      <form id="authForm" class="auth-form">
        <label>
          Username
          <input name="username" type="text" autocomplete="username" placeholder="Enter username" required />
        </label>
        <label>
          Password
          <input name="password" type="password" autocomplete="current-password" placeholder="Enter password"
            required />
        </label>
        <div class="auth-actions">
          <button type="submit" class="btn primary" style="justify-content: center;">Login</button>
          <button type="button" id="registerBtn" class="btn" style="justify-content: center;">Create Account</button>
        </div>
        <p id="authMessage" class="auth-message"></p>
      </form>
    </div>
  </section>

  <nav class="sidebar" id="sidebar" style="display: none;">
    <div class="sidebar-logo">
      <div class="brand-mark">RX</div>
      <span style="font-weight: 700; font-size: 20px;">RestartX</span>
    </div>

    <div class="nav-links">
      <button class="nav-item active" data-view="overview">
        <i data-lucide="layout-dashboard"></i> Overview
      </button>
      <button class="nav-item" data-view="workspace">
        <i data-lucide="settings"></i> Workspace
      </button>
      <button class="nav-item" data-view="campaigns">
        <i data-lucide="send"></i> Campaigns
      </button>
      <button class="nav-item" data-view="analytics">
        <i data-lucide="bar-chart-3"></i> Analytics
      </button>
      <button class="nav-item" data-view="leads">
        <i data-lucide="users"></i> Leads
      </button>
      <button class="nav-item" data-view="automation">
        <i data-lucide="bot"></i> Automation
      </button>
      <button class="nav-item" data-view="agent">
        <i data-lucide="brain"></i> Agent
      </button>
      <button class="nav-item" data-view="alerts">
        <i data-lucide="bell-ring"></i> Alerts
      </button>
      <button class="nav-item" data-view="livechat">
        <i data-lucide="message-circle"></i> Live Chat
      </button>
    </div>

    <div class="sidebar-footer">
      <div class="status-chip" style="border-radius: var(--radius-sm); padding: 12px;">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusChip" style="font-weight: 600;">stopped</span>
      </div>

      <div class="user-info" style="padding: 0 12px;">
        <div class="muted" style="font-size: 12px;">Logged in as</div>
        <div id="userPill" style="font-weight: 600;">-</div>
      </div>

      <div style="display: flex; gap: 8px; padding: 0 12px;">
        <label class="theme-switch" style="scale: 0.8; margin-left: -5px;">
          <input type="checkbox" id="themeToggle">
          <span class="slider"></span>
        </label>
        <button id="logoutBtn" class="btn" style="padding: 4px 8px; font-size: 12px; border: none;">
          <i data-lucide="log-out"></i> Logout
        </button>
      </div>
    </div>
  </nav>

  <main class="layout" style="display: none;">
    <!-- Overview View -->
    <div class="view-container active" id="overviewView">
      <section class="panel hero" style="grid-column: span 12;">
        <div class="brand-section">
          <p class="eyebrow">Dashboard / Overview</p>
          <h1>Health & Connectivity</h1>
          <p class="subtitle muted" style="margin-top: 8px;">Monitor your WhatsApp client status and quick stats.</p>
        </div>

        <div class="status-grid" style="margin-top: 0;">
          <div class="status-chip">üìÖ <span id="schedulerChip">scheduler: off</span></div>
          <div class="status-chip">üë• <span id="recipientChip">recipients: 0</span></div>
        </div>
      </section>

      <section class="panel qr-panel" style="grid-column: span 5;">
        <h2>QR Authentication</h2>
        <p class="muted">Click <strong>Start WhatsApp</strong> to generate a new QR code.</p>
        <div class="qr-box" id="qrBox" style="margin: 20px 0;">
          <div class="muted">Client not started</div>
        </div>
        <div class="action-row" style="display: flex; gap: 12px;">
          <button id="startBtn" class="btn primary" style="flex: 1; justify-content: center;">Start Client</button>
          <button id="stopBtn" class="btn danger" style="flex: 1; justify-content: center;">Stop Client</button>
        </div>
        <p class="connect-note" id="statusHintText" style="margin-top: 12px; font-size: 13px;"></p>
        <div id="connectTimer" style="font-size: 11px; margin-top: 8px;" class="muted">Connect timer: 0s</div>
      </section>

      <section class="panel quick-stats" style="grid-column: span 7;">
        <h2>Quick Analytics</h2>
        <div class="status-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
          <div class="status-chip"
            style="flex: 1; padding: 24px; flex-direction: column; align-items: flex-start; gap: 4px;">
            <span class="muted" style="font-size: 12px;">Total Sent</span>
            <span id="overviewTotal" style="font-size: 24px; font-weight: 700;">0</span>
          </div>
          <div class="status-chip"
            style="flex: 1; padding: 24px; flex-direction: column; align-items: flex-start; gap: 4px;">
            <span class="muted" style="font-size: 12px;">Success Rate</span>
            <span id="overviewRate" style="font-size: 24px; font-weight: 700; color: var(--primary);">0%</span>
          </div>
        </div>

        <div style="margin-top: 32px;">
          <h3 style="font-size: 14px; margin-bottom: 12px;">Recent Event Log</h3>
          <pre id="events"
            style="font-size: 11px; max-height: 200px; overflow-y: auto; background: var(--import-bg); color: var(--ink); padding: 12px; border-radius: var(--radius-md); border: 1px solid var(--panel-border);"></pre>
        </div>
      </section>
    </div>

    <!-- Workspace View -->
    <div class="view-container" id="workspaceView">
      <section class="panel hero" style="grid-column: span 12;">
        <div class="brand-section">
          <p class="eyebrow">Settings / Configuration</p>
          <h1>Workspace Settings</h1>
        </div>
        <div style="display: flex; gap: 12px; align-items: center;">
          <select id="workspaceSelect" style="width: auto; height: 44px;"></select>
          <div
            style="display: flex; background: var(--panel-bg); border: 1px solid var(--panel-border); border-radius: var(--radius-md); padding: 2px;">
            <input id="workspaceNameInput" type="text" placeholder="New workspace..."
              style="border: none; background: transparent; width: 150px;" />
            <button id="createWorkspaceBtn" class="btn primary"
              style="border-radius: 10px; padding: 8px 16px;">Add</button>
          </div>
        </div>
      </section>

      <section class="panel config-panel" style="grid-column: span 12;">
        <form id="configForm" class="form-grid">
          <label>
            Headless Browser
            <select name="HEADLESS">
              <option value="true">Enable (Headless)</option>
              <option value="false">Disable (Visible)</option>
            </select>
          </label>

          <label>
            Schedule Auto-Send
            <select name="SCHEDULE_ENABLED">
              <option value="false">Off</option>
              <option value="true">On</option>
            </select>
          </label>

          <div class="span-2"
            style="padding: 24px; background: linear-gradient(135deg, rgba(124, 58, 237, 0.05) 0%, rgba(37, 99, 235, 0.05) 100%); border: 1px dashed var(--primary); border-radius: var(--radius-md); margin: 12px 0;">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
              <div
                style="background: var(--primary); color: white; padding: 8px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="bot"></i>
              </div>
              <div>
                <h3 style="margin: 0; font-size: 16px;">AI Sales Closer (Beta)</h3>
                <p class="muted" style="font-size: 12px; margin: 0;">Automate personalized sales conversations using
                  Gemini AI.</p>
              </div>
            </div>

            <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 16px;">
              <label>
                Enable AI Sales Agent
                <select name="AI_SALES_ENABLED">
                  <option value="false">Disabled</option>
                  <option value="true">Enabled</option>
                </select>
              </label>
              <label>
                AI Provider
                <select name="AI_PROVIDER">
                  <option value="google">Google Gemini</option>
                  <option value="openrouter">OpenRouter.ai</option>
                </select>
              </label>
              <label>
                AI Model (ID)
                <input name="AI_MODEL" list="ai-models" placeholder="e.g. gemini-1.5-flash" />
                <datalist id="ai-models">
                  <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                  <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                  <option value="gemini-2.0-flash-lite-preview-02-05">Gemini 2.0 Flash Lite</option>
                  <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
                  <option value="openai/gpt-4o-mini">GPT-4o Mini (OpenRouter)</option>
                  <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet (OpenRouter)</option>
                  <option value="google/gemini-2.0-flash-001">Gemini 2.0 Flash (OpenRouter)</option>
                </datalist>
              </label>
              <label>
                AI Response Scope
                <select name="AI_SALES_SCOPE">
                  <option value="not_matched">Only if keywords don't match</option>
                  <option value="all">Respond to EVERY message</option>
                </select>
              </label>
              <label>
                Include Group Chats
                <select name="AI_SALES_GROUPS">
                  <option value="false">No (Individual chats only)</option>
                  <option value="true">Yes (Respond in groups)</option>
                </select>
              </label>
              <label class="span-2">
                AI API Key
                <input name="AI_API_KEY" type="password" placeholder="Enter your Google or OpenRouter Key..." />
              </label>
              <label>
                Enable Call Booking
                <select name="AI_BOOKING_ENABLED">
                  <option value="false">Off</option>
                  <option value="true">On</option>
                </select>
              </label>
              <label>
                Booking Link (Calendly, etc.)
                <input name="AI_BOOKING_LINK" type="text" placeholder="https://calendly.com/your-link" />
              </label>
              <label>
                Memory Depth (Turns)
                <select name="AI_MEMORY_TURNS">
                  <option value="5">5 turns (~10 messages)</option>
                  <option value="10" selected>10 turns (~20 messages)</option>
                  <option value="15">15 turns (~30 messages)</option>
                  <option value="20">20 turns (~40 messages)</option>
                </select>
              </label>
              <label>
                Qualification Gate
                <select name="AI_QUALIFICATION_ENABLED">
                  <option value="true">On</option>
                  <option value="false">Off</option>
                </select>
              </label>
              <label class="span-2">
                Qualification Fields
                <input name="AI_QUALIFICATION_FIELDS" type="text"
                  placeholder="need,budget,timeline,decision-maker" />
              </label>
              <label>
                Closing Flow
                <select name="AI_CLOSING_FLOW">
                  <option value="balanced">Balanced</option>
                  <option value="direct">Direct</option>
                  <option value="consultative">Consultative</option>
                </select>
              </label>
              <label>
                Close Question Mode
                <select name="AI_CLOSE_QUESTION_MODE">
                  <option value="hot_only">Hot only</option>
                  <option value="warm_hot">Warm + Hot</option>
                  <option value="always">Always</option>
                  <option value="off">Off</option>
                </select>
              </label>
              <label>
                Auto Story Before Close
                <select name="AI_AUTO_STORY_TO_CLOSE">
                  <option value="false">Off</option>
                  <option value="true">On</option>
                </select>
              </label>
              <label>
                WhatsApp Status Features
                <select name="AI_WHATSAPP_STATUS_FEATURES">
                  <option value="false">Off</option>
                  <option value="true">On</option>
                </select>
              </label>
              <label>
                Follow-up Automation
                <select name="AI_FOLLOW_UP_ENABLED">
                  <option value="false">Off</option>
                  <option value="true">On</option>
                </select>
              </label>
              <label>
                Follow-up Delay (Minutes)
                <input name="AI_FOLLOW_UP_DELAY_MINUTES" type="number" min="5" max="10080" />
              </label>
              <label>
                Max Follow-up Attempts
                <input name="AI_FOLLOW_UP_MAX_ATTEMPTS" type="number" min="1" max="10" />
              </label>
              <label class="span-2">
                Story Snippet (used before close questions)
                <textarea name="AI_CLOSING_STORY" rows="2"
                  placeholder="A short proof story the AI can insert before asking closing questions..."></textarea>
              </label>
              <label class="span-2">
                WhatsApp Status Features Text
                <textarea name="AI_WHATSAPP_STATUS_FEATURES_TEXT" rows="2"
                  placeholder="Mention how WhatsApp Status features help attract inbound leads..."></textarea>
              </label>
              <label class="span-2">
                Objection Playbook
                <textarea name="AI_OBJECTION_PLAYBOOK" rows="3"
                  placeholder="Example: Price objection -> compare ROI in 30 days, then offer a pilot..."></textarea>
              </label>
              <label class="span-2">
                Follow-up Template
                <input name="AI_FOLLOW_UP_TEMPLATE" type="text"
                  placeholder="Quick follow-up: still interested in solving this now?" />
              </label>
              <div class="span-2"
                style="padding: 14px; border: 1px dashed var(--panel-border); border-radius: var(--radius-md); background: var(--import-bg);">
                <h4 style="margin: 0 0 10px 0; font-size: 13px;">Auto AI Status Lead Seeking</h4>
                <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 10px;">
                  <label>
                    Enable Auto Status
                    <select name="AI_STATUS_AUTOPILOT_ENABLED">
                      <option value="false">Off</option>
                      <option value="true">On</option>
                    </select>
                  </label>
                  <label>
                    Use AI Generation
                    <select name="AI_STATUS_AUTOPILOT_USE_AI">
                      <option value="true">On</option>
                      <option value="false">Off (template only)</option>
                    </select>
                  </label>
                  <label>
                    Status Cron
                    <input name="AI_STATUS_AUTOPILOT_CRON" type="text" placeholder="0 */6 * * *" />
                  </label>
                  <label>
                    Status Tone
                    <select name="AI_STATUS_AUTOPILOT_TONE">
                      <option value="direct">Direct</option>
                      <option value="friendly">Friendly</option>
                      <option value="consultative">Consultative</option>
                    </select>
                  </label>
                  <label class="span-2">
                    Status CTA
                    <input name="AI_STATUS_AUTOPILOT_CTA" type="text"
                      placeholder="Reply 'START' to get full details." />
                  </label>
                </div>
                <div style="display:flex;gap:10px;align-items:center;margin-top:10px;">
                  <button type="button" id="postStatusNowBtn" class="btn accent">Post Status Now</button>
                  <span id="statusPostResult" class="muted" style="font-size:12px;"></span>
                </div>
              </div>
              <div class="span-2"
                style="padding: 14px; border: 1px dashed var(--panel-border); border-radius: var(--radius-md); background: var(--import-bg);">
                <h4 style="margin: 0 0 10px 0; font-size: 13px;">AI Data Assist</h4>
                <p class="muted" style="margin: 0 0 12px 0; font-size: 12px;">Auto-create product knowledge, closing
                  story, objection playbook, and follow-up text.</p>
                <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 10px;">
                  <label>
                    Business Name
                    <input id="assistBusinessName" type="text" placeholder="RestartX" />
                  </label>
                  <label>
                    Offer
                    <input id="assistOffer" type="text" placeholder="WhatsApp automation for sales teams" />
                  </label>
                  <label>
                    Target Audience
                    <input id="assistAudience" type="text" placeholder="SMBs and outbound teams" />
                  </label>
                  <label>
                    Goal
                    <input id="assistGoal" type="text" placeholder="Book qualified demos" />
                  </label>
                  <label>
                    Tone
                    <select id="assistTone">
                      <option value="balanced">Balanced</option>
                      <option value="direct">Direct</option>
                      <option value="friendly">Friendly</option>
                      <option value="consultative">Consultative</option>
                    </select>
                  </label>
                  <div style="display:flex;align-items:flex-end;">
                    <button type="button" id="generateAiAssistBtn" class="btn accent"
                      style="width:100%;justify-content:center;">Generate AI Assist Data</button>
                  </div>
                </div>
                <p id="aiAssistResult" class="muted" style="margin: 10px 0 0 0; font-size: 12px;"></p>
              </div>
              <label class="span-2">
                Product Knowledge / Sales Script
                <p class="muted" style="font-size: 12px; margin-bottom: 8px;">Describe your product, pricing, and common
                  questions. The AI will use this to close sales.</p>
                <textarea name="AI_PRODUCT_KNOWLEDGE" rows="5"
                  placeholder="Example: Product: Eco-Bottle, Price: $25. It's BPA-free and keeps water cold for 24h..."></textarea>
              </label>
            </div>
          </div>

          <label class="span-2">
            Recipients (List)
            <textarea name="RECIPIENTS" rows="3" placeholder="91889..., 91859..."></textarea>
          </label>

          <div class="span-2 import-box">
            <h3 style="font-size: 14px; margin-bottom: 12px;">Import from Excel/CSV</h3>
            <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end;">
              <input id="recipientsFile" type="file" accept=".xlsx,.xls,.csv" style="flex: 1; min-width: 200px;" />
              <button type="button" id="importBtn" class="btn accent">Import Numbers</button>
            </div>
            <p id="importResult" class="muted" style="margin-top: 8px; font-size: 12px;"></p>
          </div>

          <label class="span-2">
            Template Content (One per line for rotation)
            <textarea name="BULK_TEMPLATE_LINES" id="templateInput" rows="4"
              placeholder="Type your message templates here..."></textarea>
          </label>

          <div class="span-2">
            <h3 style="font-size: 14px; margin-bottom: 12px;">Message Preview</h3>
            <div class="preview-container" id="messagePreview">
              <div class="msg-bubble sent">Your message will appear here...</div>
            </div>
          </div>

          <button class="btn primary span-2" type="submit" style="height: 50px; font-size: 16px;">Save Workspace
            Configuration</button>
        </form>
      </section>
    </div>

    <!-- Campaigns View -->
    <div class="view-container" id="campaignsView">
      <section class="panel hero" style="grid-column: span 12;">
        <div class="brand-section">
          <p class="eyebrow">Marketing / Outreach</p>
          <h1>Instant Campaigns</h1>
        </div>
        <div class="status-chip" style="border-color: var(--primary);">Sequence Active</div>
      </section>

      <section class="panel custom-panel" style="grid-column: span 12;">
        <form id="customForm" class="form-grid">
          <div class="span-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <span class="eyebrow" style="font-size: 10px;">Message 1 (Intro)</span>
              <textarea name="message1" id="instantMessage1" rows="6"
                placeholder="First message to spark interest..."></textarea>
            </div>
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <span class="eyebrow" style="font-size: 10px; color: var(--accent);">Message 2 (Follow-up)</span>
              <textarea name="message2" id="instantMessage2" rows="6"
                placeholder="Second message with more details..."></textarea>
            </div>
          </div>

          <div class="span-2 preview-section">
            <h3 style="font-size: 14px; margin-bottom: 12px;">Live Conversation Preview</h3>
            <div class="preview-container" id="multiMessagePreview" style="min-height: 250px;">
              <div class="msg-bubble received">Preview will appear as you type...</div>
            </div>
          </div>

          <div class="span-2" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:start;">
            <div style="display:flex;flex-direction:column;gap:8px;">
              <label class="eyebrow" style="font-size:11px;">Upload Media (images, audio, docs)</label>
              <input type="file" id="mediaFileInput" />
              <div style="display:flex;gap:8px;">
                <button id="uploadMediaBtn" class="btn">Upload</button>
                <span id="uploadResult" class="muted" style="font-size:12px;align-self:center;"></span>
              </div>
            </div>

            <div style="display:flex;flex-direction:column;gap:8px;">
              <label class="eyebrow" style="font-size:11px;">Select Uploaded Media</label>
              <select id="mediaListSelect">
                <option value="">(none)</option>
              </select>
              <label style="font-size:11px;margin-top:6px;">Schedule send</label>
              <input type="datetime-local" id="sendAtInput" />
            </div>
          </div>

          <div class="span-2 progress-section" id="bulkProgress" style="display: none;">
            <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px;">
              <span>Launching Campaign sequence...</span>
              <span id="progressText">0/0</span>
            </div>
            <div class="progress-wrapper">
              <div class="progress-bar" id="progressBar"></div>
            </div>
          </div>

          <button type="submit" class="btn accent span-2" style="height: 60px; font-size: 18px; width: 100%;">üöÄ Launch
            Dual-Message Campaign</button>
        </form>
      </section>

      <!-- Scheduled Messages Queue -->
      <section class="panel" style="grid-column: span 12;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h2 style="margin: 0;">üìã Scheduled Queue</h2>
          <button id="refreshSchedulesBtn" class="btn" style="padding: 6px 12px; font-size: 12px;">
            <i data-lucide="refresh-cw"></i> Refresh
          </button>
        </div>
        <div class="table-scroll">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Message</th>
                <th>Media</th>
                <th>Send At</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="schedulesTableBody">
              <!-- Scheduled items injected here -->
            </tbody>
          </table>
        </div>
        <div id="schedulesEmpty" class="muted" style="text-align: center; padding: 24px; display: none;">
          No scheduled messages yet. Use <strong>Schedule send</strong> above to queue one.
        </div>
      </section>

      <!-- Media Library -->
      <section class="panel" style="grid-column: span 12;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h2 style="margin: 0;">üìÅ Media Library</h2>
          <button id="refreshMediaBtn" class="btn" style="padding: 6px 12px; font-size: 12px;">
            <i data-lucide="refresh-cw"></i> Refresh
          </button>
        </div>
        <div class="table-scroll">
          <table class="data-table">
            <thead>
              <tr>
                <th>Filename</th>
                <th>Type</th>
                <th>Uploaded</th>
                <th>ID</th>
              </tr>
            </thead>
            <tbody id="mediaTableBody">
              <!-- Media items injected here -->
            </tbody>
          </table>
        </div>
        <div id="mediaEmpty" class="muted" style="text-align: center; padding: 24px; display: none;">
          No media uploaded yet. Use <strong>Upload Media</strong> above to add files.
        </div>
      </section>
    </div>

    <!-- Analytics View -->
    <div class="view-container" id="analyticsView">
      <section class="panel hero" style="grid-column: span 12;">
        <div class="brand-section">
          <p class="eyebrow">Reports / Metrics</p>
          <h1>Campaign Analytics</h1>
        </div>
        <div style="display: flex; gap: 12px; align-items: center;">
          <input id="reportFrom" type="datetime-local" style="width: auto;" />
          <input id="reportTo" type="datetime-local" style="width: auto;" />
          <button id="refreshReportsBtn" class="btn primary">Update</button>
          <a id="exportCsvLink" class="btn" href="#">Export CSV</a>
        </div>
      </section>

      <!-- ‚îÄ‚îÄ Message Stats ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <section class="panel analytics-section" style="grid-column: span 12;">
        <h3 class="analytics-section-title"><i data-lucide="bar-chart-3" style="width:18px;height:18px;vertical-align:middle;"></i> Message Statistics</h3>
        <div class="analytics-grid analytics-grid-6">
          <div class="analytics-card">
            <span class="analytics-card-label">Total</span>
            <span id="reportTotal" class="analytics-card-value">0</span>
          </div>
          <div class="analytics-card">
            <span class="analytics-card-label">Delivered</span>
            <span id="reportSentOk" class="analytics-card-value" style="color:var(--primary);">0</span>
          </div>
          <div class="analytics-card">
            <span class="analytics-card-label">Failed</span>
            <span id="reportSentFailed" class="analytics-card-value" style="color:var(--danger);">0</span>
          </div>
          <div class="analytics-card">
            <span class="analytics-card-label">Auto-Replies</span>
            <span id="reportAutoReplies" class="analytics-card-value" style="color:var(--accent);">0</span>
          </div>
          <div class="analytics-card">
            <span class="analytics-card-label">Follow-Ups</span>
            <span id="reportFollowUps" class="analytics-card-value" style="color:var(--primary);">0</span>
          </div>
          <div class="analytics-card">
            <span class="analytics-card-label">Auto-Statuses</span>
            <span id="reportAutoStatuses" class="analytics-card-value" style="color:var(--accent);">0</span>
          </div>
        </div>
      </section>

      <!-- ‚îÄ‚îÄ Daily Volume Chart ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <section class="panel analytics-section" style="grid-column: span 12;">
        <h3 class="analytics-section-title"><i data-lucide="trending-up" style="width:18px;height:18px;vertical-align:middle;"></i> Daily Message Volume</h3>
        <div id="dailyVolumeChart" class="daily-volume-chart">
          <span class="muted">Loading chart data‚Ä¶</span>
        </div>
        <div id="dailyVolumeLegend" class="daily-volume-legend" style="display:none;">
          <span><span class="legend-dot" style="background:var(--primary);"></span> Sent</span>
          <span><span class="legend-dot" style="background:var(--accent);"></span> Received</span>
          <span><span class="legend-dot" style="background:var(--danger);"></span> Failed</span>
        </div>
      </section>

      <!-- ‚îÄ‚îÄ Revenue Overview ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <section class="panel analytics-section" style="grid-column: span 12;">
        <h3 class="analytics-section-title"><i data-lucide="dollar-sign" style="width:18px;height:18px;vertical-align:middle;"></i> Revenue Overview</h3>
        <div class="analytics-grid analytics-grid-5">
          <div class="analytics-card">
            <span class="analytics-card-label">Total Revenue</span>
            <span id="anTotalRevenue" class="analytics-card-value" style="color:var(--primary);">‚Äî</span>
          </div>
          <div class="analytics-card">
            <span class="analytics-card-label">This Week</span>
            <span id="anWeeklyRevenue" class="analytics-card-value">‚Äî</span>
          </div>
          <div class="analytics-card">
            <span class="analytics-card-label">This Month</span>
            <span id="anMonthlyRevenue" class="analytics-card-value">‚Äî</span>
          </div>
          <div class="analytics-card">
            <span class="analytics-card-label">Avg Deal Size</span>
            <span id="anAvgDeal" class="analytics-card-value">‚Äî</span>
          </div>
          <div class="analytics-card">
            <span class="analytics-card-label">ROI</span>
            <span id="anROI" class="analytics-card-value">‚Äî</span>
          </div>
        </div>
      </section>

      <!-- ‚îÄ‚îÄ Lead Funnel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <section class="panel analytics-section" style="grid-column: span 7;">
        <h3 class="analytics-section-title"><i data-lucide="filter" style="width:18px;height:18px;vertical-align:middle;"></i> Lead Funnel</h3>
        <div id="leadFunnelBars" class="funnel-container">
          <span class="muted">Loading‚Ä¶</span>
        </div>
        <div class="analytics-grid analytics-grid-3" style="margin-top:16px;">
          <div class="analytics-card analytics-card-sm">
            <span class="analytics-card-label">Conversion Rate</span>
            <span id="anConvRate" class="analytics-card-value" style="font-size:22px;">‚Äî</span>
          </div>
          <div class="analytics-card analytics-card-sm">
            <span class="analytics-card-label">Avg Days to Close</span>
            <span id="anDaysClose" class="analytics-card-value" style="font-size:22px;">‚Äî</span>
          </div>
          <div class="analytics-card analytics-card-sm">
            <span class="analytics-card-label">Rev / Lead</span>
            <span id="anRevPerLead" class="analytics-card-value" style="font-size:22px;">‚Äî</span>
          </div>
        </div>
      </section>

      <!-- ‚îÄ‚îÄ Lead Temperature & Win/Loss ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <section class="panel analytics-section" style="grid-column: span 5;">
        <h3 class="analytics-section-title"><i data-lucide="thermometer" style="width:18px;height:18px;vertical-align:middle;"></i> Lead Temperature</h3>
        <div id="leadTempBars" class="temp-container" style="margin-bottom:20px;">
          <span class="muted">Loading‚Ä¶</span>
        </div>
        <h3 class="analytics-section-title" style="margin-top:8px;"><i data-lucide="target" style="width:18px;height:18px;vertical-align:middle;"></i> Win / Loss</h3>
        <div class="analytics-grid analytics-grid-3">
          <div class="analytics-card analytics-card-sm">
            <span class="analytics-card-label">Win Rate</span>
            <span id="anWinRate" class="analytics-card-value" style="font-size:22px;color:var(--primary);">‚Äî</span>
          </div>
          <div class="analytics-card analytics-card-sm">
            <span class="analytics-card-label">Won</span>
            <span id="anWonCount" class="analytics-card-value" style="font-size:22px;">‚Äî</span>
          </div>
          <div class="analytics-card analytics-card-sm">
            <span class="analytics-card-label">Lost</span>
            <span id="anLostCount" class="analytics-card-value" style="font-size:22px;">‚Äî</span>
          </div>
        </div>
        <div id="anScoringInsight" class="analytics-insight" style="margin-top:12px;display:none;"></div>
      </section>

      <!-- ‚îÄ‚îÄ Activity by Source ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <section class="panel analytics-section" style="grid-column: span 6;">
        <h3 class="analytics-section-title"><i data-lucide="pie-chart" style="width:18px;height:18px;vertical-align:middle;"></i> Activity by Source</h3>
        <div id="sourceBreakdown" class="source-breakdown">
          <span class="muted">Loading‚Ä¶</span>
        </div>
      </section>

      <!-- ‚îÄ‚îÄ Top Converting Tags ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <section class="panel analytics-section" style="grid-column: span 6;">
        <h3 class="analytics-section-title"><i data-lucide="tags" style="width:18px;height:18px;vertical-align:middle;"></i> Top Converting Tags</h3>
        <div id="topTagsList" class="top-tags-list">
          <span class="muted">Need closed-won leads for tag analysis.</span>
        </div>
      </section>

      <!-- ‚îÄ‚îÄ Recent Activity Log ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <section class="panel analytics-section" style="grid-column: span 12;">
        <h3 class="analytics-section-title"><i data-lucide="list" style="width:18px;height:18px;vertical-align:middle;"></i> Recent Activity</h3>
        <div class="table-scroll">
          <table class="data-table" id="recentActivityTable">
            <thead>
              <tr>
                <th>Time</th>
                <th>Kind</th>
                <th>Source</th>
                <th>Status</th>
                <th>Preview</th>
              </tr>
            </thead>
            <tbody id="recentActivityBody">
              <tr><td colspan="5" class="muted" style="text-align:center;">Loading‚Ä¶</td></tr>
            </tbody>
          </table>
        </div>
      </section>
    </div>
    <!-- Leads View -->
    <div class="view-container" id="leadsView">
      <section class="panel hero" style="grid-column: span 12;">
        <div class="brand-section">
          <p class="eyebrow">CRM / AI Insights</p>
          <h1>Leads Dashboard</h1>
          <p class="subtitle muted" style="margin-top: 8px;">Automatically tracked and scored by AI.</p>
        </div>
        <button id="refreshLeadsBtn" class="btn primary">
          <i data-lucide="refresh-cw"></i> Refresh Leads
        </button>
      </section>

      <section class="panel" style="grid-column: span 12; padding: 0; overflow: hidden;">
        <div class="table-scroll">
          <table class="data-table" id="leadsTable">
            <thead>
              <tr>
                <th>Contact</th>
                <th>Status</th>
                <th>Stage</th>
                <th>Score</th>
                <th>Reasoning</th>
                <th>Last Message</th>
                <th>Updated</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="leadsTableBody">
              <!-- Leads will be injected here -->
            </tbody>
          </table>
        </div>
        <div id="leadsEmptyState" style="padding: 48px; text-align: center; display: none;">
          <i data-lucide="users" style="width: 48px; height: 48px; margin-bottom: 16px; opacity: 0.2;"></i>
          <p class="muted">No leads tracked yet. Start a conversation to see AI insights.</p>
        </div>
      </section>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ Automation View ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="view-container" id="automationView">
      <section class="panel hero" style="grid-column: span 12;">
        <div class="brand-section">
          <p class="eyebrow">Autonomous Engine</p>
          <h1>Automation Hub</h1>
          <p class="subtitle muted" style="margin-top: 8px;">10 autonomous features that run on autopilot.</p>
        </div>
        <button id="refreshAutomationBtn" class="btn primary">
          <i data-lucide="refresh-cw"></i> Refresh
        </button>
      </section>

      <!-- Feature toggles -->
      <section class="panel" style="grid-column: span 12;">
        <h3 style="margin-bottom: 16px;"><i data-lucide="toggle-right" style="width:18px;height:18px;vertical-align:middle;"></i> Feature Toggles</h3>
        <p class="muted" style="margin-bottom: 16px; font-size: 13px;">Toggle autonomous features on/off. Changes are saved instantly to workspace config.</p>
        <div id="automationToggles" class="automation-grid">
          <!-- Injected by JS -->
        </div>
      </section>

      <!-- Nurture Drip -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="droplets" style="width:18px;height:18px;vertical-align:middle;"></i> Nurture Drip</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Multi-day automated sequences. Enroll leads to start dripping.</p>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;">
          <button id="enrollAllDripBtn" class="btn primary" style="font-size:13px;"><i data-lucide="users"></i> Enroll All Leads</button>
        </div>
        <div id="dripSteps" style="margin-top:12px;font-size:13px;" class="muted"></div>
      </section>

      <!-- A/B Testing -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="split" style="width:18px;height:18px;vertical-align:middle;"></i> A/B Testing</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Test message variants and auto-pick the winner.</p>
        <form id="abTestForm" style="margin-top:12px;">
          <input type="text" id="abTestName" placeholder="Test name" style="width:100%;margin-bottom:8px;padding:8px;border:1px solid var(--panel-border);border-radius:var(--radius-sm);background:var(--panel-bg);color:var(--text-primary);" />
          <textarea id="abTestVariants" rows="4" placeholder="Enter variants, one per line (min 2)" style="width:100%;margin-bottom:8px;padding:8px;border:1px solid var(--panel-border);border-radius:var(--radius-sm);background:var(--panel-bg);color:var(--text-primary);resize:vertical;font-family:inherit;"></textarea>
          <button type="submit" class="btn primary" style="font-size:13px;"><i data-lucide="play"></i> Start Test</button>
        </form>
        <div id="abTestResults" style="margin-top:12px;font-size:13px;"></div>
      </section>

      <!-- Daily Digest Preview -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="newspaper" style="width:18px;height:18px;vertical-align:middle;"></i> Daily Digest</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Preview what the daily summary looks like.</p>
        <button id="previewDigestBtn" class="btn" style="font-size:13px;margin-top:8px;"><i data-lucide="eye"></i> Preview Digest</button>
        <pre id="digestPreview" style="margin-top:12px;font-size:12px;white-space:pre-wrap;max-height:300px;overflow-y:auto;padding:12px;background:var(--preview-bg);border-radius:var(--radius-sm);display:none;"></pre>
      </section>

      <!-- Lead Routing -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="git-branch" style="width:18px;height:18px;vertical-align:middle;"></i> Lead Routing</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Auto-assigned routes based on score/stage.</p>
        <div id="routingTable" style="margin-top:12px;font-size:13px;max-height:300px;overflow-y:auto;"></div>
      </section>

      <!-- Escalation -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="alert-triangle" style="width:18px;height:18px;vertical-align:middle;"></i> Escalations</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Leads needing human intervention.</p>
        <button id="checkEscalationBtn" class="btn" style="font-size:13px;margin-top:8px;"><i data-lucide="scan"></i> Check Now</button>
        <div id="escalationList" style="margin-top:12px;font-size:13px;"></div>
      </section>

      <!-- Tags -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="tags" style="width:18px;height:18px;vertical-align:middle;"></i> Auto Tags & Segments</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">AI-assigned tags based on conversations.</p>
        <div id="tagsTable" style="margin-top:12px;font-size:13px;max-height:300px;overflow-y:auto;"></div>
      </section>

      <!-- Objection Tester -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="shield" style="width:18px;height:18px;vertical-align:middle;"></i> Objection Recovery</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Test how the system handles objections.</p>
        <form id="objectionTestForm" style="margin-top:12px;">
          <input type="text" id="objectionInput" placeholder="Type an objection, e.g. 'too expensive'" style="width:100%;margin-bottom:8px;padding:8px;border:1px solid var(--panel-border);border-radius:var(--radius-sm);background:var(--panel-bg);color:var(--text-primary);" />
          <button type="submit" class="btn" style="font-size:13px;"><i data-lucide="zap"></i> Test Rebuttal</button>
        </form>
        <div id="objectionResult" style="margin-top:12px;font-size:13px;"></div>
      </section>

      <!-- Timezone -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="clock" style="width:18px;height:18px;vertical-align:middle;"></i> Timezone Intelligence</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Messages are sent during optimal hours per lead's timezone.</p>
        <div id="timezoneInfo" style="margin-top:12px;font-size:13px;" class="muted">Enable this feature and the system will auto-detect timezones from phone prefixes.</div>
      </section>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ Agent View ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="view-container" id="agentView">
      <section class="panel hero" style="grid-column: span 12;">
        <div class="brand-section">
          <p class="eyebrow">Autonomous Agent</p>
          <h1>Sales Agent Brain</h1>
          <p class="subtitle muted" style="margin-top: 8px;">Self-driving sales engine ‚Äî outbound, goals, tuning, offers, revenue & self-healing.</p>
        </div>
        <button id="refreshAgentBtn" class="btn primary">
          <i data-lucide="refresh-cw"></i> Refresh
        </button>
      </section>

      <!-- Agent Feature Toggles -->
      <section class="panel" style="grid-column: span 12;">
        <h3 style="margin-bottom: 16px;"><i data-lucide="toggle-right" style="width:18px;height:18px;vertical-align:middle;"></i> Agent Feature Toggles</h3>
        <p class="muted" style="margin-bottom: 8px; font-size: 13px;">Toggle the autonomous agent brain features.</p>
        <div class="agent-master-controls">
          <button id="agentAllOnBtn" class="btn primary"><i data-lucide="power"></i> All On</button>
          <button id="agentAllOffBtn" class="btn"><i data-lucide="power-off"></i> All Off</button>
        </div>
        <div id="agentToggles" class="automation-grid"></div>
      </section>

      <!-- Goal Planner -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="target" style="width:18px;height:18px;vertical-align:middle;"></i> Goal Planner</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Set a weekly sales target and the agent auto-adjusts strategies.</p>
        <form id="goalForm" style="margin-top:12px;display:flex;flex-wrap:wrap;gap:8px;align-items:end;">
          <div style="flex:1;min-width:120px;">
            <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px;">Goal Type</label>
            <select id="goalType" style="width:100%;padding:8px;border:1px solid var(--panel-border);border-radius:var(--radius-sm);background:var(--input-bg);color:var(--ink);">
              <option value="bookings">Book calls</option>
              <option value="hot_leads">Hot leads</option>
              <option value="qualified">Qualify leads</option>
              <option value="replies">Get replies</option>
              <option value="revenue">Close revenue</option>
            </select>
          </div>
          <div style="min-width:80px;">
            <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px;">Weekly Target</label>
            <input type="number" id="goalTarget" min="1" value="5" style="width:80px;padding:8px;border:1px solid var(--panel-border);border-radius:var(--radius-sm);background:var(--input-bg);color:var(--ink);" />
          </div>
          <button type="submit" class="btn primary" style="font-size:13px;"><i data-lucide="flag"></i> Set Goal</button>
        </form>
        <div id="goalProgress" style="margin-top:16px;"></div>
        <div id="goalAdjustments" style="margin-top:8px;font-size:12px;"></div>
      </section>

      <!-- Outbound Prospecting -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="send" style="width:18px;height:18px;vertical-align:middle;"></i> Outbound Prospecting</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Agent auto-contacts the highest-opportunity leads.</p>
        <div id="outboundStats" style="margin-top:12px;font-size:13px;"></div>
        <div id="outboundQueue" style="margin-top:12px;font-size:13px;max-height:280px;overflow-y:auto;"></div>
      </section>

      <!-- Prompt Tuning -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="sliders" style="width:18px;height:18px;vertical-align:middle;"></i> Prompt Self-Tuning</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">AI analyses reply rates and auto-adjusts tone, closing style & aggressiveness.</p>
        <div id="tuningMetrics" style="margin-top:12px;font-size:13px;"></div>
        <div id="tuningRecommendations" style="margin-top:8px;font-size:12px;"></div>
        <button id="applyTuningBtn" class="btn" style="font-size:13px;margin-top:12px;"><i data-lucide="wand-2"></i> Apply Tuning Now</button>
      </section>

      <!-- Revenue Attribution -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="dollar-sign" style="width:18px;height:18px;vertical-align:middle;"></i> Revenue Attribution</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Track deal values and see ROI per channel.</p>
        <form id="revenueForm" style="margin-top:12px;display:flex;flex-wrap:wrap;gap:8px;align-items:end;">
          <div style="flex:1;min-width:140px;">
            <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px;">Lead ID</label>
            <select id="revLeadId" style="width:100%;padding:8px;border:1px solid var(--panel-border);border-radius:var(--radius-sm);background:var(--input-bg);color:var(--ink);"></select>
          </div>
          <div style="min-width:100px;">
            <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px;">Amount</label>
            <input type="number" id="revAmount" min="1" placeholder="500" style="width:100px;padding:8px;border:1px solid var(--panel-border);border-radius:var(--radius-sm);background:var(--input-bg);color:var(--ink);" />
          </div>
          <button type="submit" class="btn primary" style="font-size:13px;"><i data-lucide="plus"></i> Record</button>
        </form>
        <div id="revenueAttribution" style="margin-top:16px;font-size:13px;"></div>
        <div id="scoringFeedback" style="margin-top:8px;font-size:12px;"></div>
      </section>

      <!-- Offer Authority -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="badge-percent" style="width:18px;height:18px;vertical-align:middle;"></i> Offer Authority</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">AI auto-generates discounts within your guardrails.</p>
        <div id="offerStats" style="margin-top:12px;font-size:13px;"></div>
        <div id="offerGuardrails" style="margin-top:8px;font-size:12px;"></div>
      </section>

      <!-- Self-Healing -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="heart-pulse" style="width:18px;height:18px;vertical-align:middle;"></i> Self-Healing Workflows</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Monitors all features and auto-fixes underperformance.</p>
        <div id="healthChecks" style="margin-top:12px;font-size:13px;"></div>
        <button id="healNowBtn" class="btn" style="font-size:13px;margin-top:12px;"><i data-lucide="activity"></i> Run Health Check</button>
        <div id="healingActions" style="margin-top:8px;font-size:12px;"></div>
      </section>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ Alerts View ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="view-container" id="alertsView">
      <section class="panel hero" style="grid-column: span 12;">
        <div class="brand-section">
          <p class="eyebrow">Notifications</p>
          <h1>WhatsApp Alerts & Reports</h1>
          <p class="subtitle muted" style="margin-top: 8px;">Get real-time alerts and daily auto-reports sent to your WhatsApp.</p>
        </div>
        <button id="refreshAlertsBtn" class="btn primary">
          <i data-lucide="refresh-cw"></i> Refresh
        </button>
      </section>

      <!-- Alert Configuration -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="settings" style="width:18px;height:18px;vertical-align:middle;"></i> Alert Settings</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Configure your operator number and choose which events trigger alerts.</p>
        <form id="alertConfigForm" style="margin-top:12px;">
          <div style="margin-bottom:12px;">
            <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px;">Operator WhatsApp Number</label>
            <input type="text" id="alertOperator" placeholder="e.g. 255712345678" style="width:100%;padding:8px;border:1px solid var(--panel-border);border-radius:var(--radius-sm);background:var(--input-bg);color:var(--ink);" />
          </div>
          <div style="margin-bottom:12px;">
            <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px;">Report Interval (hours)</label>
            <input type="number" id="alertReportInterval" min="1" max="24" value="1" style="width:80px;padding:8px;border:1px solid var(--panel-border);border-radius:var(--radius-sm);background:var(--input-bg);color:var(--ink);" />
            <p class="muted" style="font-size:11px;margin-top:4px;">Send summary report every N hours (1 = hourly, 24 = daily)</p>
          </div>
          <div style="margin-bottom:12px;">
            <label style="font-size:12px;font-weight:600;display:block;margin-bottom:8px;">Master Switch</label>
            <label class="toggle-switch">
              <input type="checkbox" id="alertEnabledToggle" />
              <span class="toggle-slider"></span>
              <span class="toggle-status-label off" id="alertEnabledLabel">OFF</span>
            </label>
          </div>
          <button type="submit" class="btn primary" style="font-size:13px;"><i data-lucide="save"></i> Save Settings</button>
          <button type="button" id="sendTestAlertBtn" class="btn" style="font-size:13px;margin-left:8px;"><i data-lucide="bell-ring"></i> Send Test Alert</button>
        </form>
      </section>

      <!-- Event Subscriptions -->
      <section class="panel" style="grid-column: span 6;">
        <h3><i data-lucide="list-checks" style="width:18px;height:18px;vertical-align:middle;"></i> Alert Events</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Choose which events send you a WhatsApp notification.</p>
        <div id="alertEventsList" style="margin-top:12px;"></div>
      </section>

      <!-- Alert History -->
      <section class="panel" style="grid-column: span 12;">
        <h3><i data-lucide="history" style="width:18px;height:18px;vertical-align:middle;"></i> Alert History</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Recent alerts sent to your WhatsApp.</p>
        <div id="alertHistory" style="margin-top:12px;font-size:13px;max-height:400px;overflow-y:auto;"></div>
      </section>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ Live Chat / Human Takeover View ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="view-container" id="livechatView">
      <section class="panel hero" style="grid-column: span 12;">
        <div class="brand-section">
          <p class="eyebrow">Human Agent</p>
          <h1>Live Chat</h1>
          <p class="subtitle muted" style="margin-top: 8px;">Take over conversations from AI and chat directly with leads.</p>
        </div>
        <button id="refreshLivechatBtn" class="btn primary">
          <i data-lucide="refresh-cw"></i> Refresh
        </button>
      </section>

      <!-- Takeover a lead -->
      <section class="panel" style="grid-column: span 4;">
        <h3><i data-lucide="user-plus" style="width:18px;height:18px;vertical-align:middle;"></i> Take Over Chat</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0 12px;">Select a lead to pause AI and take control of the conversation.</p>
        <div style="margin-bottom:10px;">
          <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px;">Select Lead</label>
          <select id="takeoverLeadSelect" style="width:100%;padding:8px;border:1px solid var(--panel-border);border-radius:var(--radius-sm);background:var(--input-bg);color:var(--ink);">
            <option value="">Loading‚Ä¶</option>
          </select>
        </div>
        <div style="margin-bottom:10px;">
          <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px;">Or enter Chat ID</label>
          <input type="text" id="takeoverManualId" placeholder="e.g. 919876543210@c.us" style="width:100%;padding:8px;border:1px solid var(--panel-border);border-radius:var(--radius-sm);background:var(--input-bg);color:var(--ink);" />
        </div>
        <button id="takeoverStartBtn" class="btn primary" style="width:100%;">
          <i data-lucide="hand"></i> Take Over
        </button>
      </section>

      <!-- Active takeovers list -->
      <section class="panel" style="grid-column: span 8;">
        <h3><i data-lucide="users" style="width:18px;height:18px;vertical-align:middle;"></i> Active Takeovers</h3>
        <p class="muted" style="font-size:13px; margin: 8px 0;">Chats currently under human control ‚Äî AI is paused for these contacts.</p>
        <div id="activeTakeoversList" style="margin-top:12px;"></div>
      </section>

      <!-- Live chat area -->
      <section class="panel" style="grid-column: span 12; display:none;" id="liveChatSection">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
          <h3 id="liveChatTitle" style="margin:0;"><i data-lucide="message-circle" style="width:18px;height:18px;vertical-align:middle;"></i> Chat</h3>
          <button id="liveChatReleaseBtn" class="btn" style="font-size:12px;background:var(--danger);color:#fff;border:none;">
            <i data-lucide="log-out"></i> Release to AI
          </button>
        </div>
        <div id="liveChatMessages" style="
          height: 350px;
          overflow-y: auto;
          padding: 16px;
          background: var(--input-bg);
          border: 1px solid var(--panel-border);
          border-radius: var(--radius-md);
          margin-bottom: 12px;
          display: flex;
          flex-direction: column;
          gap: 8px;
        ">
          <span class="muted" style="text-align:center;">Select a takeover to start chatting.</span>
        </div>
        <form id="liveChatForm" style="display:flex;gap:8px;">
          <input type="text" id="liveChatInput" placeholder="Type your message‚Ä¶" style="
            flex:1;
            padding:10px 14px;
            border:1px solid var(--panel-border);
            border-radius:var(--radius-sm);
            background:var(--input-bg);
            color:var(--ink);
            font-size:14px;
          " />
          <button type="submit" class="btn primary" style="white-space:nowrap;">
            <i data-lucide="send"></i> Send
          </button>
        </form>
      </section>
    </div>

  </main>

  <!-- ‚îÄ‚îÄ‚îÄ Chat History Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="chatModal" style="
    display: none;
    position: fixed;
    inset: 0;
    z-index: 2000;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(4px);
    align-items: center;
    justify-content: center;
    padding: 20px;
  ">
    <div style="
      background: var(--sidebar-bg);
      border: 1px solid var(--panel-border);
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 600px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
    ">
      <!-- Modal Header -->
      <div style="
        padding: 20px 24px;
        border-bottom: 1px solid var(--panel-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      ">
        <div>
          <div style="font-weight: 700; font-size: 16px;" id="chatModalTitle">Conversation</div>
          <div class="muted" style="font-size: 12px;" id="chatModalSubtitle"></div>
        </div>
        <div style="display: flex; gap: 8px;">
          <button id="clearHistoryBtn" class="btn"
            style="font-size: 12px; padding: 6px 12px; color: var(--danger); border-color: var(--danger);">
            <i data-lucide="trash-2"></i> Clear
          </button>
          <button id="closeChatModal" class="btn" style="font-size: 12px; padding: 6px 12px;">
            <i data-lucide="x"></i> Close
          </button>
        </div>
      </div>
      <!-- Message Thread -->
      <div id="chatModalMessages" style="
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        background: var(--preview-bg);
        background-image: var(--preview-bg-img);
        background-size: cover;
      ">
        <div class="muted" style="text-align: center; font-size: 13px;">Loading...</div>
      </div>
      <!-- Message count footer -->
      <div id="chatModalFooter" style="
        padding: 12px 20px;
        border-top: 1px solid var(--panel-border);
        font-size: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      ">
        <span class="muted" id="chatModalCount"></span>
        <span class="muted">Memory: last <span id="chatModalMemoryDepth">10</span> turns</span>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    // Initialize Lucide icons on load and after any dynamic DOM changes
    function initIcons() {
      if (window.lucide) window.lucide.createIcons();
    }
    initIcons();
  </script>
</body>

</html>
